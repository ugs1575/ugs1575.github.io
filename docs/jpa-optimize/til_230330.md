---
layout: default
title: TIL_230330
parent: JPA BASIC
last_modified_at: "23.03.30"
---

# TIL_230330
{: .no_toc }

<details open markdown="block">
  <summary>
    Table of contents
  </summary>
  {: .text-delta }
- TOC
{:toc}
</details>

# 엔티티 개발 주의 / 참고 사항
## 자기 자신을 관계로 가지고 있는 엔티티 설계
- 부모 카테고리와 자식 카테고리를 가지고 있다. 쉽게 생각해보면 @ManyToOne 관계로 연관관계를 지정할 수 있다.

```java
@Entity
@Getter @Setter
public class Category {

	@Id @GeneratedValue
	@Column(name = "category_id")
	private Long id;

	private String name;

	@ManyToOne
	@JoinColumn(name = "parent_id")
	private Category parent;

	@OneToMany(mappedBy = "parent")
	private List<Category> child = new ArrayList<>();

}
```

## Getter, Setter
- Setter를 무분별하게 열어두면 변경이 어디서 일어났는지 추적하기 힘들기 때문에 setter 대신 별도의 메소드를 두는 것이 좋다.

## id는 관례상 테이블명_id로 따로 컬럼명을 설정한다.
- join 할 때도 편하고 구분이 쉽다.

## @ManyToMany 대신 중간테이블을 엔티티로 승격 후 @ManyToOne @OneToMany로 풀기

## 값타입은 변경 불가능하도록 설계
- @Setter는 생성하지 말고 생성자를 이용하자.
- JPA 스펙상 엔티티나 임베디드 타입( @Embeddable )은 자바 기본 생성자(default constructor)를 public 또는 protected 로 설정해야 한다. 
- public 으로 두는 것 보다는 protected 로 설정하는 것이 그나마 더 안전하다.
- JPA가 이런 제약을 두는 이유는 JPA 구현 라이브러리가 객체를 생성할 때 리플랙션 같은 기술을 사용할 수 있도록 지원해야 하기 때문이다.

## Ref.
- <a href="https://www.inflearn.com/course%EC%8A%A4%ED%94%84%EB%A7%81%EB%B6%80%ED%8A%B8-JPA-%ED%99%9C%EC%9A%A9-1/dashboard">김영한님의 JPA 강의</a>
